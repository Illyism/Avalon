extends ../layout

block head
  - var title = mkTitle(avalon.website.news.title)
  - var description = avalon.website.news.description
  - var keywords = mkKeywords(avalon.website.news.keywords)
  - var canonical = "http://www.avalon-rpg.com/news/"
  - var body = "news"
block content
  .ui.content.news
    .contain
      h1.ui.title.center.underline #{meta.title}
      p.lead #{meta.summary}
      
      .section.bulletin.boards.box.ui
        h2.ui.title.underline #{meta.bulletin.title}
        .ui.grid.responsive.two.columns
          for item in meta.bulletin.items
            .column
              h4.ui.title: a(href=item.url) #{item.title}
              | #{item.description}

      .section.affairs.box.ui
        h2.ui.title.underline #{meta.affairs.title}
        .ui.grid.responsive.two.columns
          for item in meta.affairs.items
            .column
              h4.ui.title: a(href=item.url) #{item.title}
              | #{item.description}

      //- .section.history.ui.box
      //-   .ui.grid.responsive.one.columns
      //-     for link in meta.links
      //-       .column
      //-         h2.ui.title: a(href=link.url) #{link.title}
      //-         | #{link.description}

      //- .section.modern.box.ui
      //-   h2.ui.title.underline #{meta.modern.title}
      //-   .ui.grid.responsive.two.columns
      //-     for item in meta.modern.items
      //-       .column
      //-         h4.ui.title: a(href=item.url) #{item.title}
      //-         | #{item.description}


      if recent
        .recent.section.ui.box
          h2.ui.title.underline Recent events in Society
          table.ui.table
            thead
              tr
                th Date
                th Event
            tbody
              for update in recent
                tr
                  td(width="20%") #{update.date}
                  td #{update.item}

      .section.box.ui
        h2.ui.title.underline Forthcoming Events
        table.ui.table
          thead
            tr
              th Date
              th Event
          tbody
            for update,key in events
              for event in update
                tr
                  td(width="20%") !{key}
                  td !{event}
        .text.help !{scheduleHelp}

      .section.military.affairs.box.ui
        h2.ui.title.underline #{meta.military.title}
        table.ui.sortable.selectable.revealable.table#militaryTable
          thead
            tr
              th(data-sort="string") Village
              th(data-sort="string") City
              th(data-sort="string") Conflict
              th(data-sort="string") Occupied
              th(data-sort="int") Legions
          tbody
            for affair,i in affairs
              tr(data-id=i, class={expand: affair.legions})
                td
                  if affair.legions
                    i.icon.angle.down
                  | #{affair.village}
                td #{affair.city}
                td #{affair.conflict}
                td #{affair.occupied}
                if affair.legions
                  td #{affair.legions.length}
                else
                  td 0
                if affair.legions
                  td(data-id=i, style="", colspan="5").expandable
                    table(width="100%", class="ui box small")
                      thead
                        tr
                          th Legion
                          th Structure
                          th Commander
                          th Size
                      tbody
                        for legion in affair.legions
                          - leg = legion.match(/^(\w+) (\w+) (\w+) x (\d+)$/)
                          if leg
                            tr
                              td #{leg[1]}
                              td #{leg[2]}
                              td #{leg[3]}
                              td #{leg[4]}
block scripts
  script(src="/js/jquery.table.js")
  script(src="/js/affairs.js")